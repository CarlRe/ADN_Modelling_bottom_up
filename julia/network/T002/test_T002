#Test für erste Versuche mit UW Osterburken Trafo 1

using PowerDynamics: read_powergrid, Json, Inc, find_operationpoint, ChangeInitialConditions, LineFailure, PowerPerturbation, simulate
using Plots
powergrid = read_powergrid(joinpath(@__DIR__,"gridT002.json"), Json)
operationpoint = find_operationpoint(powergrid,sol_method = :dynamic)

timespan= (0.0,5.)
include("plot.jl")

# simulating a Power perturbation at bus2
fault1 = PowerPerturbation(node="bus5", fault_power=-0.21, tspan_fault=(1.,5.), var=:P0)
solution1 = simulate(fault1, powergrid, operationpoint, timespan)
plot(solution1.dqsol)
#simulating frequency pertubation at generator
fault2 = ChangeInitialConditions(node = "bus2", var=:ω , f = Inc(-0.5))
solution2 = simulate(fault2, powergrid, operationpoint, timespan)
plot(solution2, "bus2", :v, legend = (1.2, 0.7), ylabel="V [p.u.]",label = "generator")
plot(solution2, "bus2", :p, legend = (1.2, 0.7), ylabel="V [p.u.]",label = "generator")
plot(solution2, "bus2", :ω, legend = (0.8, 0.7), ylabel="ω [rad/s]",label ="generator")